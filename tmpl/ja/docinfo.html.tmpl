[% PROCESS global/header.html.tmpl %]

<h3>ファイル更新履歴</h3>

<p>(近い時間にアップロードされた)異なるタイプのファイルは、同じバージョンの
別形式のファイルとしてアップロードされている可能性があります。</p>

[% INCLUDE entry/filelist.html.tmpl   files = file_list %]

<h3>ドキュメント情報</h3>

<form method="POST" action="docinfo.cgi">
<ul>
  <li>フルパス: 
    <span id="doc_name_raw">
      <tt><a href="pathinfo.cgi?path=[% full_path %]">/[% full_path %]</a></tt>
      <tt>[% doc_info.filename %]</tt></span>
    <span id="doc_name_edit" class="ui_hidden">
      <select name="new_pathid" onChange="AllPathChange();">
        <option value="0" [% IF doc_info.pathid == -1 %]selected="selected"[% END %]>/</option>
        [% FOREACH hid IN allpath.keys.nsort %]
          <option value="[% hid %]" [% IF hid == doc_info.pathid %]selected="selected" [% END %]>[% allpath.$hid.fullpath %]</option>
        [%- END %]
      </select>/<input type="text" size="50" name="new_name" value="[% doc_info.filename %]"></span>
    [% IF InList(file_uname, User.uid) %]
      <span id="update_link"><a href="javascript: doc_info_update();">更新</a></span>
    [% END %]</li>
  <li>セキュリティーフラグ (ダウンロード時に暗号化): 
    <span id="doc_sec_raw">[% IF doc_info.secure == 1 %]設定[% ELSE %]未設定[% END %]</span>
    <span id="doc_sec_edit" class="ui_hidden"><input type="checkbox" name="new_secure" [% IF doc_info.secure == 1 %]checked="checked"[% END %] /></span>
    </li>
  <li>アクセス可能グループ: 
    [% IF group_list.size > 0 %][% group_list.join(', ') %]
    [% ELSE %](未定義)[% END %]
    <a href="docgroup.cgi?did=[% doc_info.docid %]">[% INCLUDE show_table_icon id = 'group_add' %]</a>
    </li>
  <li>ラベル: 
    [% IF doc_labels.size > 0 %]
      [% FOREACH item IN doc_labels %]
        [% IF NOT loop.first %], [% END %]
        <span title="[% Label.$item.description %]">[% Label.$item.name %]</span>
      [% END %]
    [% ELSE %](未定義)[% END %]
    <a href="doclabel.cgi?did=[% doc_info.docid %]">[% INCLUDE show_table_icon id = 'label_add' %]</a>
    </li>
</ul>
<p>[% terms.file %] の説明</p>
    <div id="doc_desc_raw">[% doc_info.description FILTER markdown %]</div>
    <div id="doc_desc_edit" class="ui_hidden"><textarea rows="10" cols="100" name="new_description">[% doc_info.description FILTER html %]</textarea></div>
<div id="doc_update" class="ui_hidden">
  <input type="submit" value="更新">
</div>
<input type="hidden" name="did" value="[% doc_info.docid %]">
<input type="hidden" name="old_name" value="[% doc_info.filename %]">
<input type="hidden" name="old_pathid" value="[% doc_info.pathid %]">
<input type="hidden" name="old_description" value="[% doc_info.description FILTER html %]">
<input type="hidden" name="old_secure" value="[% doc_info.secure %]">
</form>

<script type="text/javascript" src="json.cgi?format=js&amp;type=allpath"></script>
<script type="text/javascript"><!--
  AllPathChange();
--></script>
<script type="text/javascript">
<!--
function doc_info_update () {
  YAHOO.util.Dom.addClass(document.getElementById('doc_name_raw'), 'ui_hidden');
  YAHOO.util.Dom.removeClass(document.getElementById('doc_name_edit'), 'ui_hidden');
  YAHOO.util.Dom.addClass(document.getElementById('doc_sec_raw'), 'ui_hidden');
  YAHOO.util.Dom.removeClass(document.getElementById('doc_sec_edit'), 'ui_hidden');
  YAHOO.util.Dom.addClass(document.getElementById('doc_desc_raw'), 'ui_hidden');
  YAHOO.util.Dom.removeClass(document.getElementById('doc_desc_edit'), 'ui_hidden');
  YAHOO.util.Dom.removeClass(document.getElementById('doc_update'), 'ui_hidden');
  YAHOO.util.Dom.addClass(document.getElementById('update_link'), 'ui_hidden');
}
// -->
</script>

[% IF UpDoc(doc_info.docid) || Admin %]
<h3>ファイルアクセスログ</h3>

[% INCLUDE entry/activity.html.tmpl   activity = activity %]
[% END %]

[% PROCESS global/footer.html.tmpl %]
